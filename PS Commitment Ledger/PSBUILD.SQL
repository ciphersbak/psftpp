DROP VIEW PS_UN_PO_ACTSUM_VW
/
CREATE VIEW PS_UN_PO_ACTSUM_VW (BUSINESS_UNIT, PO_ID, LINE_NBR,
 SCHED_NBR, DISTRIB_LINE_NUM, PO_DT, ACCOUNTING_DT, BUDGET_DT,
 CURRENCY_CD, CALC_EXCHNG_RT, CUR_EXCHNG_RT_PYMT, CUR_EXCHNG_RT,
 INV_ITEM_ID, DESCR254_MIXED, UNIT_OF_MEASURE, RECV_REQ, AMT_ONLY_FLG,
 ACCOUNT, DEPTID, OPERATING_UNIT, PRODUCT, FUND_CODE, CLASS_FLD,
 PROGRAM_CODE, BUDGET_REF, AFFILIATE, AFFILIATE_INTRA1,
 AFFILIATE_INTRA2, CHARTFIELD1, CHARTFIELD2, CHARTFIELD3,
 BUSINESS_UNIT_PC, PROJECT_ID, ACTIVITY_ID, RESOURCE_TYPE,
 RESOURCE_CATEGORY, RESOURCE_SUB_CAT, ANALYSIS_TYPE, QTY_ORDERED,
 AMT_ORDERED, QTY_RECEIVED, AMT_RECEIVED, QTY_INVOICED, AMT_INVOICED)
 AS SELECT X.BUSINESS_UNIT , X.PO_ID , X.LINE_NBR , X.SCHED_NBR ,
 X.DISTRIB_LINE_NUM , HDR.PO_DT , HDR.ACCOUNTING_DT , DIST.BUDGET_DT ,
 HDR.CURRENCY_CD AS HDR_CURR_CD ,
 NVL(ROUND((HDR.RATE_MULT/HDR.RATE_DIV) , 7) , 0.00) AS PO_HDR_RATE ,
 NVL(ROUND((DIST.RATE_MULT/DIST.RATE_DIV) , 7) , 0.00) AS PO_DIST_RATE
 , NVL(ROUND(E.CUR_EXCHNG_RT , 7) , 0.00) AS CURRENT_RATE ,
 X.INV_ITEM_ID , X.DESCR254_MIXED , X.UNIT_OF_MEASURE , X.RECV_REQ ,
 X.AMT_ONLY_FLG , X.ACCOUNT , X.DEPTID , X.OPERATING_UNIT, X.PRODUCT,
 X.FUND_CODE, X.CLASS_FLD, X.PROGRAM_CODE, X.BUDGET_REF, X.AFFILIATE,
 X.AFFILIATE_INTRA1, X.AFFILIATE_INTRA2, X.CHARTFIELD1, X.CHARTFIELD2,
 X.CHARTFIELD3 , X.BUSINESS_UNIT_PC, X.PROJECT_ID, X.ACTIVITY_ID,
 X.RESOURCE_TYPE, X.RESOURCE_CATEGORY, X.RESOURCE_SUB_CAT,
 X.ANALYSIS_TYPE , X.QTY_ORDERED , X.AMT_ORDERED_BASE ,
 SUM(X.QTY_RECEIVED) AS QTY_RECEIVED , SUM(X.AMT_RECEIVED_BASE) AS
 AMT_RECEIVED_BASE , SUM(X.QTY_INVOICED) AS QTY_INVOICED ,
 SUM(X.AMT_INVOICED_BASE) AS AMT_INVOICED_BASE FROM ( SELECT
 L.BUSINESS_UNIT , L.PO_ID , L.LINE_NBR , DIST.SCHED_NBR ,
 DIST.DISTRIB_LINE_NUM , L.INV_ITEM_ID , L.DESCR254_MIXED ,
 L.UNIT_OF_MEASURE , L.RECV_REQ , L.AMT_ONLY_FLG , DIST.ACCOUNT ,
 DIST.DEPTID , DIST.OPERATING_UNIT, DIST.PRODUCT, DIST.FUND_CODE,
 DIST.CLASS_FLD, DIST.PROGRAM_CODE, DIST.BUDGET_REF, DIST.AFFILIATE,
 DIST.AFFILIATE_INTRA1, DIST.AFFILIATE_INTRA2, DIST.CHARTFIELD1,
 DIST.CHARTFIELD2, DIST.CHARTFIELD3 , DIST.BUSINESS_UNIT_PC,
 DIST.PROJECT_ID, DIST.ACTIVITY_ID, DIST.RESOURCE_TYPE,
 DIST.RESOURCE_CATEGORY, DIST.RESOURCE_SUB_CAT, DIST.ANALYSIS_TYPE ,
 DIST.QTY_PO AS QTY_ORDERED , DIST.MERCH_AMT_BSE AS AMT_ORDERED_BASE ,
 0.00 AS QTY_RECEIVED , 0.00 AS AMT_RECEIVED_BASE , 0.00 AS
 QTY_INVOICED , 0.00 AS AMT_INVOICED_BASE FROM PS_PO_LINE L ,
 PS_PO_LINE_DISTRIB DIST WHERE L.BUSINESS_UNIT = DIST.BUSINESS_UNIT
 AND L.PO_ID = DIST.PO_ID AND L.LINE_NBR = DIST.LINE_NBR AND
 L.CANCEL_STATUS NOT IN ('C', 'X') AND DIST.DISTRIB_LN_STATUS NOT IN
 ('X', 'C') AND L.BUSINESS_UNIT LIKE '6%' GROUP BY L.BUSINESS_UNIT,
 L.PO_ID, L.LINE_NBR, DIST.SCHED_NBR, DIST.DISTRIB_LINE_NUM,
 L.INV_ITEM_ID, L.DESCR254_MIXED, L.UNIT_OF_MEASURE, L.RECV_REQ,
 L.AMT_ONLY_FLG, DIST.ACCOUNT, DIST.DEPTID, DIST.OPERATING_UNIT,
 DIST.PRODUCT, DIST.FUND_CODE, DIST.CLASS_FLD, DIST.PROGRAM_CODE,
 DIST.BUDGET_REF, DIST.AFFILIATE, DIST.AFFILIATE_INTRA1,
 DIST.AFFILIATE_INTRA2, DIST.CHARTFIELD1, DIST.CHARTFIELD2,
 DIST.CHARTFIELD3, DIST.BUSINESS_UNIT_PC, DIST.PROJECT_ID,
 DIST.ACTIVITY_ID, DIST.RESOURCE_TYPE, DIST.RESOURCE_CATEGORY,
 DIST.RESOURCE_SUB_CAT, DIST.ANALYSIS_TYPE, DIST.QTY_PO,
 DIST.MERCH_AMT_BSE UNION ALL SELECT DIST.BUSINESS_UNIT , DIST.PO_ID ,
 DIST.LINE_NBR , DIST.SCHED_NBR , DIST.DISTRIB_LINE_NUM ,
 L.INV_ITEM_ID , L.DESCR254_MIXED , L.UNIT_OF_MEASURE , L.RECV_REQ ,
 L.AMT_ONLY_FLG , DIST.ACCOUNT , DIST.DEPTID , DIST.OPERATING_UNIT,
 DIST.PRODUCT, DIST.FUND_CODE, DIST.CLASS_FLD, DIST.PROGRAM_CODE,
 DIST.BUDGET_REF, DIST.AFFILIATE, DIST.AFFILIATE_INTRA1,
 DIST.AFFILIATE_INTRA2, DIST.CHARTFIELD1, DIST.CHARTFIELD2,
 DIST.CHARTFIELD3 , DIST.BUSINESS_UNIT_PC, DIST.PROJECT_ID,
 DIST.ACTIVITY_ID, DIST.RESOURCE_TYPE, DIST.RESOURCE_CATEGORY,
 DIST.RESOURCE_SUB_CAT, DIST.ANALYSIS_TYPE , DIST.QTY_PO AS
 QTY_ORDERED , DIST.MERCH_AMT_BSE AS AMT_ORDERED_BASE ,
 NVL(ROUND(SUM(QTY_DS_ACCPT_VUOM) , 3) , 0.00) AS QTY_RECEIVED ,
 NVL(ROUND(SUM(RCVD.MERCH_AMT_BSE) , 3) , 0.00) AMT_RECEIVED_BASE ,
 0.00 AS QTY_INVOICED , 0.00 AS AMT_INVOICED_BASE FROM
 PS_PO_LINE_DISTRIB DIST , PS_RECV_LN_DISTRIB RCVD , PS_PO_LINE L
 WHERE RCVD.BUSINESS_UNIT_PO = DIST.BUSINESS_UNIT AND RCVD.PO_ID =
 DIST.PO_ID AND RCVD.LINE_NBR = DIST.LINE_NBR AND RCVD.SCHED_NBR =
 DIST.SCHED_NBR AND RCVD.PO_DIST_LINE_NUM = DIST.DISTRIB_LINE_NUM AND
 L.BUSINESS_UNIT = DIST.BUSINESS_UNIT AND L.PO_ID = DIST.PO_ID AND
 L.LINE_NBR = DIST.LINE_NBR AND DIST.BUSINESS_UNIT LIKE '6%' AND
 RCVD.RECV_DS_STATUS <> 'X' AND L.CANCEL_STATUS NOT IN ('C', 'X') AND
 DIST.DISTRIB_LN_STATUS NOT IN ('X', 'C') GROUP BY DIST.BUSINESS_UNIT,
 DIST.PO_ID, DIST.LINE_NBR, DIST.SCHED_NBR, DIST.DISTRIB_LINE_NUM,
 L.INV_ITEM_ID, L.DESCR254_MIXED, L.UNIT_OF_MEASURE, L.RECV_REQ,
 L.AMT_ONLY_FLG, DIST.ACCOUNT, DIST.DEPTID, DIST.OPERATING_UNIT,
 DIST.PRODUCT, DIST.FUND_CODE, DIST.CLASS_FLD, DIST.PROGRAM_CODE,
 DIST.BUDGET_REF, DIST.AFFILIATE, DIST.AFFILIATE_INTRA1,
 DIST.AFFILIATE_INTRA2, DIST.CHARTFIELD1, DIST.CHARTFIELD2,
 DIST.CHARTFIELD3, DIST.BUSINESS_UNIT_PC, DIST.PROJECT_ID,
 DIST.ACTIVITY_ID, DIST.RESOURCE_TYPE, DIST.RESOURCE_CATEGORY,
 DIST.RESOURCE_SUB_CAT, DIST.ANALYSIS_TYPE, DIST.QTY_PO,
 DIST.MERCH_AMT_BSE UNION ALL SELECT DIST.BUSINESS_UNIT , DIST.PO_ID ,
 DIST.LINE_NBR , DIST.SCHED_NBR , DIST.DISTRIB_LINE_NUM ,
 POL.INV_ITEM_ID , POL.DESCR254_MIXED , POL.UNIT_OF_MEASURE ,
 POL.RECV_REQ , POL.AMT_ONLY_FLG , DIST.ACCOUNT , DIST.DEPTID ,
 DIST.OPERATING_UNIT, DIST.PRODUCT, DIST.FUND_CODE, DIST.CLASS_FLD,
 DIST.PROGRAM_CODE, DIST.BUDGET_REF, DIST.AFFILIATE,
 DIST.AFFILIATE_INTRA1, DIST.AFFILIATE_INTRA2, DIST.CHARTFIELD1,
 DIST.CHARTFIELD2, DIST.CHARTFIELD3 , DIST.BUSINESS_UNIT_PC,
 DIST.PROJECT_ID, DIST.ACTIVITY_ID, DIST.RESOURCE_TYPE,
 DIST.RESOURCE_CATEGORY, DIST.RESOURCE_SUB_CAT, DIST.ANALYSIS_TYPE ,
 DIST.QTY_PO AS QTY_ORDERED , DIST.MERCH_AMT_BSE AS AMT_ORDERED_BASE ,
 0.00 AS QTY_RECEIVED , 0.00 AS AMT_RECEIVED_BASE ,
 NVL(ROUND(SUM(DLV.QTY_VCHR) , 3) , 0.00) QTY_INVOICED ,
 NVL(ROUND(SUM(DLV.MERCH_AMT_BSE) , 3) , 0.00) AMT_INVOICED_BASE FROM
 PS_VOUCHER_LINE L , PS_VOUCHER V , PS_DISTRIB_LINE DLV ,
 PS_PO_LINE_DISTRIB DIST , PS_PO_LINE POL WHERE V.BUSINESS_UNIT =
 L.BUSINESS_UNIT AND V.VOUCHER_ID = L.VOUCHER_ID AND V.BUSINESS_UNIT =
 DLV.BUSINESS_UNIT AND V.VOUCHER_ID = DLV.VOUCHER_ID AND
 L.VOUCHER_LINE_NUM = DLV.VOUCHER_LINE_NUM AND L.BUSINESS_UNIT_PO =
 DIST.BUSINESS_UNIT AND L.PO_ID = DIST.PO_ID AND L.LINE_NBR =
 DIST.LINE_NBR AND DLV.SCHED_NBR = DIST.SCHED_NBR AND
 DLV.PO_DIST_LINE_NUM = DIST.DISTRIB_LINE_NUM AND POL.BUSINESS_UNIT =
 DIST.BUSINESS_UNIT AND POL.PO_ID = DIST.PO_ID AND POL.LINE_NBR =
 DIST.LINE_NBR AND L.BUSINESS_UNIT_PO <> ' ' AND L.PO_ID <> ' ' AND
 V.ENTRY_STATUS <> 'X' AND V.VOUCHER_STYLE <> 'THRD' AND
 (V.MANUAL_CLOSE_DT IS NULL OR EXISTS ( SELECT 'X' FROM
 PS_PYMNT_VCHR_XREF X WHERE X.BUSINESS_UNIT = V.BUSINESS_UNIT AND
 X.VOUCHER_ID = V.VOUCHER_ID AND X.PYMNT_SELCT_STATUS <> 'X')) AND
 POL.CANCEL_STATUS NOT IN ('C', 'X') AND DIST.DISTRIB_LN_STATUS NOT IN
 ('X', 'C') AND DIST.BUSINESS_UNIT LIKE '6%' GROUP BY
 DIST.BUSINESS_UNIT, DIST.PO_ID, DIST.LINE_NBR, DIST.SCHED_NBR,
 DIST.DISTRIB_LINE_NUM, POL.INV_ITEM_ID, POL.DESCR254_MIXED,
 POL.UNIT_OF_MEASURE, POL.RECV_REQ, POL.AMT_ONLY_FLG, DIST.ACCOUNT,
 DIST.DEPTID, DIST.OPERATING_UNIT, DIST.PRODUCT, DIST.FUND_CODE,
 DIST.CLASS_FLD, DIST.PROGRAM_CODE, DIST.BUDGET_REF, DIST.AFFILIATE,
 DIST.AFFILIATE_INTRA1, DIST.AFFILIATE_INTRA2, DIST.CHARTFIELD1,
 DIST.CHARTFIELD2, DIST.CHARTFIELD3, DIST.BUSINESS_UNIT_PC,
 DIST.PROJECT_ID, DIST.ACTIVITY_ID, DIST.RESOURCE_TYPE,
 DIST.RESOURCE_CATEGORY, DIST.RESOURCE_SUB_CAT, DIST.ANALYSIS_TYPE,
 DIST.QTY_PO, DIST.MERCH_AMT_BSE ) X, PS_PO_HDR HDR,
 PS_PO_LINE_DISTRIB DIST, PS_CUR_RT_TBL E, PS_BUS_UNIT_TBL_GL F WHERE
 X.BUSINESS_UNIT = HDR.BUSINESS_UNIT AND X.PO_ID = HDR.PO_ID AND
 X.BUSINESS_UNIT = DIST.BUSINESS_UNIT AND X.PO_ID = DIST.PO_ID AND
 X.LINE_NBR = DIST.LINE_NBR AND X.SCHED_NBR = DIST.SCHED_NBR AND
 X.DISTRIB_LINE_NUM = DIST.DISTRIB_LINE_NUM AND DIST.BUSINESS_UNIT_GL
 = F.BUSINESS_UNIT AND E.FROM_CUR = HDR.CURRENCY_CD AND E.TO_CUR =
 F.BASE_CURRENCY AND E.CUR_RT_TYPE = 'UNORE' AND E.EFFDT=(SELECT
 MAX(EFFDT) FROM PS_CUR_RT_TBL E1 WHERE E1.FROM_CUR=E.FROM_CUR AND
 E1.TO_CUR=E.TO_CUR AND E1.CUR_RT_TYPE=E.CUR_RT_TYPE AND
 E1.EFFDT<=TO_DATE(TO_CHAR(SYSDATE,'YYYY-MM-DD'),'YYYY-MM-DD')) AND
 E.EFF_STATUS = 'A' AND X.BUSINESS_UNIT LIKE '6%' AND HDR.PO_STATUS
 NOT IN ('C', 'X', 'PX') AND DIST.DISTRIB_LN_STATUS NOT IN ('X', 'C')
 AND DIST.KK_CLOSE_FLAG <> 'Y' AND X.BUSINESS_UNIT <> ' ' AND X.PO_ID
 <> ' ' GROUP BY X.BUSINESS_UNIT, X.PO_ID, X.LINE_NBR, X.SCHED_NBR,
 X.DISTRIB_LINE_NUM, HDR.PO_DT, HDR.ACCOUNTING_DT, DIST.BUDGET_DT,
 HDR.CURRENCY_CD, NVL(ROUND((HDR.RATE_MULT/HDR.RATE_DIV), 7), 0),
 NVL(ROUND((DIST.RATE_MULT/DIST.RATE_DIV), 7), 0),
 NVL(ROUND(E.CUR_EXCHNG_RT, 7), 0), X.INV_ITEM_ID, X.DESCR254_MIXED,
 X.UNIT_OF_MEASURE, X.RECV_REQ, X.AMT_ONLY_FLG, X.ACCOUNT, X.DEPTID,
 X.OPERATING_UNIT, X.PRODUCT, X.FUND_CODE, X.CLASS_FLD, X.PROGRAM_CODE
, X.BUDGET_REF, X.AFFILIATE, X.AFFILIATE_INTRA1, X.AFFILIATE_INTRA2,
 X.CHARTFIELD1, X.CHARTFIELD2, X.CHARTFIELD3, X.BUSINESS_UNIT_PC,
 X.PROJECT_ID, X.ACTIVITY_ID, X.RESOURCE_TYPE, X.RESOURCE_CATEGORY,
 X.RESOURCE_SUB_CAT, X.ANALYSIS_TYPE, X.QTY_ORDERED, X.AMT_ORDERED_BASE
/
